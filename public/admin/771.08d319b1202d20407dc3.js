"use strict";(self.webpackChunkpayload_template_ts_blank=self.webpackChunkpayload_template_ts_blank||[]).push([[771],{59771:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var l=a(67294),i=a(16550),s=a(26793),n=a(9980),o=a(28630),d=a(75091),r=a(47489),u=a(2143),c=a(88348),f=a(83780);const p=(e,t)=>t?e.fields.filter((e=>(0,f.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var v=a(19826),$=a(40684),m=a(45074),b=a(91455),h=a(30894),k=a(28960);const E=e=>{var t,a,f;const{collection:E,isEditing:S}=e,{slug:g,labels:{plural:w},admin:{useAsTitle:_,components:{views:{Edit:C}={}}={}}={}}=E,[P]=(0,l.useState)((()=>p(E,S))),[Z]=(0,l.useState)((()=>({...E,fields:P}))),[y,L]=(0,l.useState)(),U=(0,$.bU)(),{serverURL:A,routes:{admin:D,api:N}}=(0,n.Z)(),{params:{id:R}={}}=(0,i.$B)(),{state:T}=(0,i.TH)(),x=(0,i.k6)(),{setStepNav:B}=(0,d.FP)(),[F,G]=(0,l.useState)(),{permissions:H,user:K}=(0,o.a)(),{getVersions:V,preferencesKey:j}=(0,m.x5)(),{getPreference:q}=(0,b.G)(),{t:z,i18n:I}=(0,s.$)("general"),J=(0,l.useCallback)((async e=>{var t;if(V(),S){const t=await(0,v.Z)({fieldSchema:Z.fields,data:e.doc,user:K,id:R,operation:"update",locale:U,t:z});G(t)}else L(`${D}/collections/${Z.slug}/${null===(t=null==e?void 0:e.doc)||void 0===t?void 0:t.id}`)}),[D,Z,S,V,K,R,z,U]),[{data:M,isLoading:O,isError:Q}]=(0,r.Z)(S?`${A}${N}/${g}/${R}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),W=(null==T?void 0:T.data)||M;if((0,l.useEffect)((()=>{const e=[{url:`${D}/collections/${g}`,label:(0,k.i)(w,I)}];if(S){let t="";W&&(t=_?W[_]?W[_]:`[${z("untitled")}]`:W.id),e.push({label:t})}else e.push({label:z("createNew")});B(e)}),[B,S,w,W,g,_,D,z,I]),(0,l.useEffect)((()=>{if(O)return;(async()=>{const e=await(0,v.Z)({fieldSchema:P,data:W,user:K,operation:S?"update":"create",id:R,locale:U,t:z});await q(j),G(e)})()}),[W,P,S,R,K,U,O,j,q,z]),(0,l.useEffect)((()=>{y&&x.push(y)}),[x,y]),Q)return l.createElement(i.l_,{to:`${D}/not-found`});const X=null===(t=null==H?void 0:H.collections)||void 0===t?void 0:t[g],Y=`${A}${N}/${g}/${R}${Z.versions.drafts?"?draft=true":""}`,ee=`${A}${N}/${g}${S?`/${R}`:""}?locale=${U}&depth=0&fallback-locale=null`,te=S&&(null===(a=null==X?void 0:X.update)||void 0===a?void 0:a.permission)||!S&&(null===(f=null==X?void 0:X.create)||void 0===f?void 0:f.permission);return l.createElement(h.f.Provider,{value:1},l.createElement(u.Z,{DefaultComponent:c.Z,CustomComponent:C,componentProps:{id:R,isLoading:!F,data:W,collection:Z,permissions:X,isEditing:S,onSave:J,initialState:F,hasSavePermission:te,apiURL:Y,action:ee}}))}}}]);